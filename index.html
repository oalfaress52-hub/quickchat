<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quickchat - Home</title>
  <script type="module" src="firebase.js"></script>
  <script type="module" src="app.js"></script>
</head>
<body>
  <h1>Quickchat</h1>

  <!-- Login -->
  <div id="loginContainer">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login / Sign Up</button>
  </div>

  <!-- Server Actions -->
  <div id="serverActions" style="display:none;">
    <input type="text" id="serverName" placeholder="New Server Name">
    <button id="createServerBtn">Create Server</button>

    <input type="text" id="joinCode" placeholder="Enter Server Code">
    <button id="joinServerBtn">Join Server</button>
  </div>

  <script type="module">
    import { auth } from './firebase.js';
    import { createServer, joinServer } from './app.js';
    import { signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "firebase/auth";

    let currentUser;

    // Handle auth state
    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('serverActions').style.display = 'block';
      }
    });

    // Login / signup
    document.getElementById('loginBtn').onclick = async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        currentUser = (await signInWithEmailAndPassword(auth, email, password)).user;
      } catch {
        // If login fails, create account
        currentUser = (await createUserWithEmailAndPassword(auth, email, password)).user;
      }
    };

    // Create server
    document.getElementById('createServerBtn').onclick = async () => {
      const name = document.getElementById('serverName').value;
      const serverId = await createServer(currentUser, name);
      window.location.href = `server.html?serverId=${serverId}`;
    };

    // Join server
    document.getElementById('joinServerBtn').onclick = async () => {
      const code = document.getElementById('joinCode').value;
      await joinServer(code, currentUser);
      window.location.href = `server.html?serverId=${code}`;
    };
  </script>
</body>
</html>
